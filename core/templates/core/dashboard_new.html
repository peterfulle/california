{% extends 'base.html' %}

{% block title %}Dashboard - Silicon Founders{% endblock %}

{% block dashboard_content %}
<div class="space-y-6 max-w-7xl mx-auto">
    <!-- Header compacto y responsivo -->
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4">
        <div class="space-y-1">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">
                {% now "H" as current_hour %}
                {% if current_hour|floatformat:0|add:0 < 12 %}
                    Good morning, {{ user.first_name|default:user.username }}
                {% elif current_hour|floatformat:0|add:0 < 18 %}
                    Good afternoon, {{ user.first_name|default:user.username }}
                {% else %}
                    Good evening, {{ user.first_name|default:user.username }}
                {% endif %}
            </h1>
            <p class="text-sm sm:text-base text-gray-600">
                {% if profile.user_type == 'founder' %}
                    Drive your startup to success
                {% elif profile.user_type == 'investor' %}
                    Discover the next opportunities
                {% else %}
                    Explore the innovation ecosystem
                {% endif %}
            </p>
        </div>
        <div class="text-left sm:text-right space-y-1">
            <div class="text-xs text-gray-500">Today</div>
            <div class="text-sm font-semibold text-gray-900">{{ "now"|date:"M d, Y" }}</div>
            <div class="text-xs text-gray-500">{{ "now"|date:"H:i" }}</div>
        </div>
    </div>

    <!-- Estadísticas del ecosistema - SOLO para investors y community, NO para founders -->
    {% if profile.user_type != 'founder' %}
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 sm:gap-4">
        <div class="stat-card bg-white p-4 sm:p-5 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-200">
            <div class="flex items-center justify-between">
                <div class="space-y-1">
                    <p class="text-xs font-medium text-gray-600 uppercase tracking-wider">Startups</p>
                    <p class="text-xl sm:text-2xl font-bold text-gray-900">{{ ecosystem_stats.total_startups }}</p>
                    <div class="flex items-center text-green-600 text-xs">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        +12%
                    </div>
                </div>
                <div class="p-2 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card bg-white p-4 sm:p-5 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-200">
            <div class="flex items-center justify-between">
                <div class="space-y-1">
                    <p class="text-xs font-medium text-gray-600 uppercase tracking-wider">Investors</p>
                    <p class="text-xl sm:text-2xl font-bold text-gray-900">{{ ecosystem_stats.total_investors }}</p>
                    <div class="flex items-center text-green-600 text-xs">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        +8%
                    </div>
                </div>
                <div class="p-2 bg-gradient-to-r from-green-500 to-green-600 rounded-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card bg-white p-4 sm:p-5 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-200">
            <div class="flex items-center justify-between">
                <div class="space-y-1">
                    <p class="text-xs font-medium text-gray-600 uppercase tracking-wider">Funding</p>
                    <p class="text-xl sm:text-2xl font-bold text-gray-900">${{ ecosystem_stats.total_funding|floatformat:0 }}M</p>
                    <div class="flex items-center text-green-600 text-xs">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        +25%
                    </div>
                </div>
                <div class="p-2 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card bg-white p-3 sm:p-4 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-200">
            <div class="flex items-center justify-between">
                <div class="space-y-1">
                    <p class="text-sm font-medium text-gray-600">Recaudando</p>
                    <p class="text-base sm:text-lg font-bold text-gray-900">{{ ecosystem_stats.active_fundraising }}</p>
                    <div class="flex items-center text-orange-600 text-xs">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        +15% activas
                    </div>
                </div>
                <div class="p-2 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card bg-white p-3 sm:p-4 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-200">
            <div class="flex items-center justify-between">
                <div class="space-y-1">
                    <p class="text-sm font-medium text-gray-600">Capital Buscado</p>
                    <p class="text-base sm:text-lg font-bold text-gray-900">${{ ecosystem_stats.total_seeking|floatformat:0 }}M</p>
                    <div class="flex items-center text-indigo-600 text-xs">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Oportunidades
                    </div>
                </div>
                <div class="p-2 bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card bg-white p-3 sm:p-4 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-200">
            <div class="flex items-center justify-between">
                <div class="space-y-1">
                    <p class="text-sm font-medium text-gray-600">Nuevos</p>
                    <p class="text-xl sm:text-2xl font-bold text-gray-900">{{ ecosystem_stats.new_this_month }}</p>
                    <div class="flex items-center text-emerald-600 text-xs">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Este mes
                    </div>
                </div>
                <div class="p-2 bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <!-- Fin de estadísticas del ecosistema -->
    
    <!-- Contenido específico por tipo de usuario -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
        <!-- Columna principal -->
        <div class="lg:col-span-2 space-y-4 sm:space-y-6 lg:space-y-8">
            {% if profile.user_type == 'founder' %}
                {% include 'core/dashboard_founder.html' %}
            {% elif profile.user_type == 'investor' %}
                {% include 'core/dashboard_investor.html' %}
            {% else %}
                {% include 'core/dashboard_community.html' %}
            {% endif %}
            
            <!-- Gráfico de actividad -->
            <div class="card-modern p-4 sm:p-6" data-animate>
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg sm:text-xl font-bold text-gray-900">Actividad del Ecosistema</h2>
                    <div class="flex space-x-2">
                        <button class="px-3 py-1.5 text-xs sm:text-sm font-medium bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors">
                            7 días
                        </button>
                        <button class="px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100 transition-colors">
                            30 días
                        </button>
                        <button class="px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100 transition-colors">
                            90 días
                        </button>
                    </div>
                </div>
                <div class="h-64 sm:h-80">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Columna lateral -->
        <div class="space-y-4 sm:space-y-6 lg:space-y-8">
            <!-- Startups destacadas - SOLO para investors y community, NO para founders -->
            {% if profile.user_type != 'founder' %}
            <div class="card-modern p-4 sm:p-6" data-animate>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Startups Destacadas</h3>
                    <a href="{% url 'core:startup_directory' %}" class="text-primary-600 hover:text-primary-700 text-xs sm:text-sm font-medium">
                        Ver todas
                    </a>
                </div>
                <div class="space-y-3">
                    {% for startup in recent_activity.recent_startups|slice:":4" %}
                    <div class="flex items-center space-x-3 p-2 sm:p-3 rounded-lg hover:bg-gray-50 transition-colors group cursor-pointer">
                        <div class="flex-shrink-0">
                            {% if startup.logo %}
                                <img class="h-10 w-10 rounded-lg object-cover" src="{{ startup.logo.url }}" alt="{{ startup.name }}">
                            {% else %}
                                <div class="h-10 w-10 rounded-lg bg-gradient-to-r from-primary-500 to-purple-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">{{ startup.name|first }}</span>
                                </div>
                            {% endif %}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold text-gray-900 truncate group-hover:text-primary-600 transition-colors">
                                {{ startup.name }}
                            </p>
                            <p class="text-xs text-gray-600 truncate">{{ startup.industry.name }}</p>
                            <div class="flex items-center mt-1">
                                <div class="flex items-center">
                                    {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= startup.rating|default:4 %}
                                            <svg class="w-2.5 h-2.5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                        {% else %}
                                            <svg class="w-2.5 h-2.5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <span class="text-xs text-gray-500 ml-1">{{ startup.rating|default:4.0|floatformat:1 }}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            {% if startup.funding_stage %}
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    {{ startup.funding_stage }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-6">
                        <svg class="w-10 h-10 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <p class="text-sm text-gray-500">No hay startups disponibles</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Inversores activos -->
            <div class="card-modern p-4 sm:p-6" data-animate>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Inversores Activos</h3>
                    <a href="{% url 'core:investor_directory' %}" class="text-primary-600 hover:text-primary-700 text-xs sm:text-sm font-medium">
                        Ver todos
                    </a>
                </div>
                <div class="space-y-3">
                    {% for investor in recent_activity.recent_investors|slice:":4" %}
                    <div class="flex items-center space-x-3 p-2 sm:p-3 rounded-lg hover:bg-gray-50 transition-colors group cursor-pointer">
                        <div class="flex-shrink-0">
                            {% if investor.profile_image %}
                                <img class="h-10 w-10 rounded-lg object-cover" src="{{ investor.profile_image.url }}" alt="{{ investor.user.get_full_name }}">
                            {% else %}
                                <div class="h-10 w-10 rounded-lg bg-gradient-to-r from-green-500 to-teal-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">{{ investor.user.first_name|first }}{{ investor.user.last_name|first }}</span>
                                </div>
                            {% endif %}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold text-gray-900 truncate group-hover:text-primary-600 transition-colors">
                                {{ investor.user.get_full_name }}
                            </p>
                            <p class="text-xs text-gray-600 truncate">{{ investor.company_name|default:"Inversor Individual" }}</p>
                            <p class="text-xs text-gray-500">{{ investor.investment_range|default:"Rango no especificado" }}</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                Activo
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-6">
                        <svg class="w-10 h-10 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                        <p class="text-sm text-gray-500">No hay inversores disponibles</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Eventos próximos -->
            <div class="card-modern p-4 sm:p-6" data-animate>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Próximos Eventos</h3>
                    <a href="#" class="text-primary-600 hover:text-primary-700 text-xs sm:text-sm font-medium">
                        Ver calendario
                    </a>
                </div>
                <div class="space-y-3">
                    {% for event in recent_activity.upcoming_events %}
                    <div class="flex items-start space-x-3 p-2 sm:p-3 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                        <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-r 
                            {% if forloop.counter == 1 %}from-red-500 to-pink-600
                            {% elif forloop.counter == 2 %}from-blue-500 to-indigo-600
                            {% elif forloop.counter == 3 %}from-green-500 to-emerald-600
                            {% else %}from-purple-500 to-violet-600{% endif %} 
                            rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-xs">{{ event.start_datetime.day }}</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold text-gray-900 truncate">{{ event.title }}</p>
                            <p class="text-xs text-gray-600 truncate">{{ event.description|truncatechars:40 }}</p>
                            <p class="text-xs text-gray-500">
                                {{ event.start_datetime|date:"d M, Y" }} - {{ event.start_datetime|time:"H:i" }}
                                {% if event.is_virtual %}
                                    <span class="ml-2 inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                                        Virtual
                                    </span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-6">
                        <svg class="w-10 h-10 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-sm text-gray-500">No hay eventos próximos</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Configuración del gráfico de actividad
    const ctx = document.getElementById('activityChart').getContext('2d');
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
            datasets: [{
                label: 'Startups registradas',
                data: [12, 19, 8, 15, 22, 8, 14],
                borderColor: '#0ea5e9',
                backgroundColor: 'rgba(14, 165, 233, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#0ea5e9',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }, {
                label: 'Inversores activos',
                data: [7, 11, 5, 8, 13, 5, 9],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#10b981',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            size: 14,
                            weight: '500'
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 12,
                            weight: '500'
                        }
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        borderDash: [5, 5],
                        color: '#f1f5f9'
                    },
                    ticks: {
                        font: {
                            size: 12,
                            weight: '500'
                        }
                    }
                }
            },
            elements: {
                point: {
                    hoverBackgroundColor: '#ffffff'
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
});
</script>

                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
